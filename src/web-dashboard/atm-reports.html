<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تصفية برو - تقرير الصراف</title>
    <link rel="icon" type="image/png" href="assets/favicon.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="تصفية برو">
    <link rel="apple-touch-icon" href="assets/icon-512.png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">

    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css?v=20">
    <style>
        /* Better Table Padding - Fix for cells touching borders */
        .table-container table th,
        .table-container table td {
            padding: 0.85rem 1rem !important;
            vertical-align: middle !important;
        }




        /* Mobile Card Float & Glow Effect */
        @media (max-width: 768px) {

            /* Remove parent container frame on mobile */
            .pro-card {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }

            .pro-card .border-bottom {
                border-bottom: none !important;
                padding: 0 0.5rem 1rem 0.5rem !important;
            }

            /* Card base styling */
            .glass-card {
                margin-bottom: 1.2rem;
                transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
                    box-shadow 0.3s ease;
                will-change: transform, box-shadow;
            }

            /* HOVER STATE - Float + Colored Glow */
            .glass-card:hover,
            .glass-card:active {
                /* Float up */
                transform: translateY(-10px) scale(1.02) !important;

                /* Strong colored shadow using the --card-glow variable */
                box-shadow:
                    0 20px 35px -5px var(--card-glow, rgba(99, 102, 241, 0.5)),
                    0 10px 20px -10px rgba(0, 0, 0, 0.3) !important;

                z-index: 999 !important;
            }
        }
    </style>
</head>

<body>

    <!-- Loading Overlay -->
    <div id="loading"
        style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,0.9);z-index:9999;display:none;align-items:center;justify-content:center;">
        <div class="spinner-border text-primary" style="width:3rem;height:3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="custom-navbar navbar-layout mb-4">
        <!-- Brand Section -->
        <div class="navbar-brand-section">
            <div class="brand-logo">
                <img src="assets/logo.png" alt="TP"
                    style="height: 45px; width: auto; margin-left: 10px; border-radius: 8px;">تصفية برو
            </div>
        </div>

        <!-- Links Section -->
        <div class="navbar-links-section">
            <a href="index.html"
                class="btn btn-sm btn-outline-secondary fw-bold text-white px-3 py-2 rounded-pill border-0 hover-bg-primary">
                <i class="fas fa-home me-1"></i> الرئيسية
            </a>
            <a href="atm-reports.html"
                class="btn btn-sm btn-primary fw-bold text-white px-3 py-2 rounded-pill shadow-sm">
                <i class="fas fa-credit-card me-1"></i> تقرير الصراف
            </a>
            <a href="customer-ledger.html"
                class="btn btn-sm btn-outline-secondary fw-bold text-white px-3 py-2 rounded-pill border-0 hover-bg-primary">
                <i class="fas fa-book me-1"></i> دفتر العملاء
            </a>
            <a href="users-management.html" id="navUsersMgmt"
                class="btn btn-sm btn-outline-secondary fw-bold text-white px-3 py-2 rounded-pill border-0 hover-bg-primary">
                <i class="fas fa-users-cog me-1"></i> إدارة المستخدمين
            </a>
            <a href="cashiers-management.html"
                class="btn btn-sm btn-outline-secondary fw-bold text-white px-3 py-2 rounded-pill border-0 hover-bg-primary">
                <i class="fas fa-cash-register me-1"></i> إدارة الكاشير
            </a>
        </div>

        <!-- User Section -->
        <div class="dropdown navbar-user-section">
            <button class="user-profile-btn" type="button" data-bs-toggle="dropdown">
                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center"
                    style="width: 32px; height: 32px;">
                    <i class="fas fa-user text-white"></i>
                </div>
                <span id="userNameDisplay" class="d-none d-md-inline fw-bold font-monospace small">Admin</span>
                <i class="fas fa-chevron-down small opacity-50"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end bg-card border-secondary shadow-lg mt-2">
                <li><a class="dropdown-item text-danger d-flex align-items-center gap-2" href="#" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                    </a></li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid px-3 px-md-4">

        <!-- Stats Row -->
        <div class="row g-3 mb-4">
            <div class="col-6 col-lg-3">
                <div class="stat-box">
                    <i class="fas fa-credit-card icon-wrapper text-primary"></i>
                    <div class="stat-label">عمليات الصراف</div>
                    <div class="stat-value text-primary" id="statsAtmOps">0</div>
                </div>
            </div>
            <div class="col-6 col-lg-3">
                <div class="stat-box">
                    <i class="fas fa-coins icon-wrapper text-success"></i>
                    <div class="stat-label">إجمالي المبالغ</div>
                    <div class="stat-value text-success" id="statsAtmTotal">0</div>
                </div>
            </div>
            <div class="col-6 col-lg-3">
                <div class="stat-box">
                    <i class="fas fa-chart-line icon-wrapper text-info"></i>
                    <div class="stat-label">متوسط المبلغ</div>
                    <div class="stat-value text-info" id="statsAtmAvg">0</div>
                </div>
            </div>
            <div class="col-6 col-lg-3">
                <div class="stat-box">
                    <i class="fas fa-trophy icon-wrapper text-warning"></i>
                    <div class="stat-label">أعلى مبلغ</div>
                    <div class="stat-value text-warning" id="statsAtmMax">0</div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-container mb-4">
            <div class="section-title">
                <i class="fas fa-search small text-primary"></i>
                البحث والفلترة
            </div>
            <div class="row g-3">
                <div class="col-6 col-md-3">
                    <label class="custom-label">من تاريخ</label>
                    <input type="date" class="custom-input w-100" id="filterDateFrom">
                </div>
                <div class="col-6 col-md-3">
                    <label class="custom-label">إلى تاريخ</label>
                    <input type="date" class="custom-input w-100" id="filterDateTo">
                </div>
                <div class="col-6 col-md-2">
                    <label class="custom-label">الكاشير</label>
                    <select class="custom-input form-select w-100" id="filterCashier">
                        <option value="all">الكل</option>
                    </select>
                </div>
                <div class="col-6 col-md-2">
                    <label class="custom-label">الفرع</label>
                    <select class="custom-input form-select w-100" id="filterBranch">
                        <option value="all">جميع الفروع</option>
                    </select>
                </div>
                <div class="col-6 col-md-2">
                    <label class="custom-label">رقم الحساب</label>
                    <select class="custom-input form-select w-100" id="filterAccount">
                        <option value="all">جميع الحسابات</option>
                    </select>
                </div>
            </div>
            <div class="row g-3 mt-1">
                <div class="col-6 col-md-3">
                    <label class="custom-label">نوع العملية</label>
                    <select class="custom-input form-select w-100" id="filterOperationType">
                        <option value="all">الكل</option>
                        <option value="mada">مدى</option>
                        <option value="visa">فيزا</option>
                        <option value="mastercard">ماستر كارد</option>
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <label class="custom-label">الجهاز</label>
                    <select class="custom-input form-select w-100" id="filterDevice">
                        <option value="all">الكل</option>
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <label class="custom-label">مبلغ محدد</label>
                    <input type="number" class="custom-input w-100" id="filterAmount" placeholder="ابحث عن مبلغ">
                </div>
                <div class="col-12 col-md-3 d-flex align-items-end">
                    <button class="btn-search" onclick="loadReconciliations()">
                        بحث <i class="fas fa-arrow-left ms-1"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="pro-card mb-4 min-vh-100">
            <div class="p-3 border-bottom border-secondary d-flex justify-content-between align-items-center">
                <div class="section-title mb-0">عمليات الصراف والبطاقات</div>
                <small class="text-secondary" id="recordCount">0 عملية</small>
            </div>

            <div class="table-container border-0 d-none d-md-block">
                <table class="custom-table atm-table">
                    <thead>
                        <tr>
                            <th class="text-center" style="text-align: center !important;">#</th>
                            <th style="text-align: center !important;">التاريخ</th>
                            <th class="text-center" style="text-align: center !important;">نوع العملية</th>
                            <th class="text-center" style="text-align: center !important;">الجهاز</th>
                            <!-- <th class="d-none d-md-table-cell">رقم الحساب</th> -->
                            <th class="text-center" style="text-align: center !important;">البنك</th>
                            <th class="text-ltr text-center" style="text-align: center !important;">المبلغ</th>
                            <th class="text-center" style="text-align: center !important;">الكاشير</th>
                            <th class="text-center" style="text-align: center !important;">رقم
                                التصفية</th>
                        </tr>
                    </thead>
                    <tbody id="atmTableBody">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Cards Container -->
            <div class="d-md-none px-2 pb-3" id="mobileCardsContainer">
                <!-- Cards will be injected here -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="detailsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold text-white">تفاصيل التصفية</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4" id="modalBody">
                    <!-- Dynamic -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auth Check
        const userStr = localStorage.getItem('user');
        if (!userStr) {
            window.location.href = '/login.html';
        }
        const user = JSON.parse(userStr || '{}');
        document.getElementById('userNameDisplay').textContent = user.name || 'Admin';

        // Navbar Protection Logic
        const protectedPages = [
            'atm-reports.html',
            'customer-ledger.html',
            'users-management.html',
            'cashiers-management.html',
            'reconciliation-requests.html',
            'request-reconciliation.html'
        ];

        if (user.permissions && Array.isArray(user.permissions)) {
            protectedPages.forEach(page => {
                if (!user.permissions.includes(page)) {
                    const el = document.querySelector(`a[href="${page}"]`);
                    if (el) el.classList.add('d-none');
                }
            });
        } else if (user.role && user.role !== 'admin') {
            protectedPages.forEach(page => {
                const el = document.querySelector(`a[href="${page}"]`);
                if (el) el.classList.add('d-none');
            });
        }

        // Check Permissions
        const isAllowed = (user.role === 'admin') || (user.permissions && user.permissions.includes('atm-reports.html'));
        if (!isAllowed) {
            console.warn('⛔ وصول غير مصرح به. إعادة التوجيه للصفحة الرئيسية.');
            window.location.href = 'index.html';
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        const API_URL = '/api';
        let allAtmRecords = [];



        let isServerFiltered = false;

        function filterAndRender() {
            const opType = document.getElementById('filterOperationType').value;
            const devFilter = document.getElementById('filterDevice').value;
            let filtered = allAtmRecords;

            // 1. Apply Client-Side Filters
            let isClientFiltered = false;

            if (opType !== 'all') {
                filtered = filtered.filter(row => {
                    const rType = (row.operation_type || '').toLowerCase();
                    if (opType === 'mada') return rType.includes('مدى') || rType.includes('mada');
                    if (opType === 'visa') return rType.includes('فيزا') || rType.includes('visa');
                    if (opType === 'mastercard') return rType.includes('ماستر') || rType.includes('master');
                    return false;
                });
                isClientFiltered = true;
            }

            if (devFilter !== 'all') {
                filtered = filtered.filter(row => row.atm_name === devFilter);
                isClientFiltered = true;
            }

            // 2. Calculate Stats on FULL matching dataset
            calculateAtmStats(filtered);

            // 3. Render Table
            // Logic: If any filter is active (Server or Client), show ALL.
            // Else (Default View), show limited 50.
            const shouldShowAll = isServerFiltered || isClientFiltered;
            renderAtmTable(shouldShowAll ? filtered : filtered.slice(0, 50));
        }

        function populateDeviceFilter(data) {
            const deviceSelect = document.getElementById('filterDevice');
            // Keep selection if refreshing data
            const currentVal = deviceSelect.value;

            deviceSelect.innerHTML = '<option value="all">الكل</option>';

            const devices = [...new Set(data.map(item => item.atm_name).filter(Boolean))];

            devices.forEach(dev => {
                const opt = document.createElement('option');
                opt.value = dev;
                opt.textContent = dev;
                deviceSelect.appendChild(opt);
            });

            if (devices.includes(currentVal)) deviceSelect.value = currentVal;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Defaults: This Month (Disabled to show all)
            // const date = new Date();
            // const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).toISOString().split('T')[0];
            // const today = new Date().toISOString().split('T')[0];

            // document.getElementById('filterDateFrom').value = firstDay;
            // document.getElementById('filterDateTo').value = today;

            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';

            await loadLookups();
            loadReconciliations();
        });

        async function loadLookups() {
            try {
                const res = await fetch(`${API_URL}/lookups`, { cache: 'no-store' });
                const data = await res.json();
                if (data.success) {
                    // Populate Cashiers
                    const cashierSelect = document.getElementById('filterCashier');
                    data.cashiers.forEach(c => {
                        const opt = document.createElement('option');
                        opt.value = c.id;
                        opt.textContent = c.name;
                        cashierSelect.appendChild(opt);
                    });

                    // Populate Branches
                    const branchSelect = document.getElementById('filterBranch');
                    if (data.branches) {
                        data.branches.forEach(b => {
                            const opt = document.createElement('option');
                            opt.value = b.id;
                            opt.textContent = b.name;
                            branchSelect.appendChild(opt);
                        });
                    }

                    // Populate Accounts (ATM Locations)
                    const accountSelect = document.getElementById('filterAccount');
                    if (data.accounts) {
                        data.accounts.forEach(acc => {
                            const opt = document.createElement('option');
                            opt.value = acc.name;
                            opt.textContent = acc.name;
                            accountSelect.appendChild(opt);
                        });
                    }
                }
            } catch (e) { console.error(e); }
        }

        async function loadReconciliations() {
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            const cashierId = document.getElementById('filterCashier').value;
            const branchId = document.getElementById('filterBranch').value;
            const accountLocation = document.getElementById('filterAccount').value;
            const specificAmount = document.getElementById('filterAmount').value;

            // Update global flag
            isServerFiltered = (dateFrom || dateTo || (cashierId && cashierId !== 'all') || (branchId && branchId !== 'all') || (accountLocation && accountLocation !== 'all') || specificAmount);

            const params = new URLSearchParams();
            if (dateFrom) params.append('dateFrom', dateFrom);
            if (dateTo) params.append('dateTo', dateTo);
            if (cashierId && cashierId !== 'all') params.append('cashierId', cashierId);
            if (branchId && branchId !== 'all') params.append('branchId', branchId);
            if (accountLocation && accountLocation !== 'all') params.append('accountLocation', accountLocation);
            if (specificAmount) params.append('specificAmount', specificAmount);

            showLoading(true);
            try {
                const res = await fetch(`${API_URL}/atm-report?${params.toString()}`, { cache: 'no-store' });
                const result = await res.json();

                if (result.success) {
                    allAtmRecords = result.data;
                    populateDeviceFilter(result.data);
                    filterAndRender();
                }
            } catch (error) {
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        function renderAtmTable(data) {
            const tbody = document.getElementById('atmTableBody');
            const cardsContainer = document.getElementById('mobileCardsContainer');

            tbody.innerHTML = '';
            if (cardsContainer) cardsContainer.innerHTML = '';

            document.getElementById('recordCount').textContent = `${data.length} عملية`;

            if (data.length === 0) {
                const emptyHtml = `<tr><td colspan="8" class="text-center py-5"><div class="text-muted opacity-50"><i class="fas fa-inbox fa-3x mb-3"></i><br>لا توجد بيانات للعرض</div></td></tr>`;
                tbody.innerHTML = emptyHtml;
                if (cardsContainer) cardsContainer.innerHTML = `<div class="text-center py-5 text-white-50"><i class="fas fa-inbox fa-3x mb-3 opacity-50"></i><br>لا توجد بيانات للعرض</div>`;
                return;
            }

            // 1. Render Desktop Table
            tbody.innerHTML = data.map((row, index) => {
                // Operation type badge
                let opBadge = '';
                const opType = (row.operation_type || '').toLowerCase();
                if (opType.includes('مدى') || opType.includes('mada')) {
                    opBadge = '<span class="badge bg-info text-white">مدى</span>';
                } else if (opType.includes('فيزا') || opType.includes('visa')) {
                    opBadge = '<span class="badge bg-primary text-white">فيزا</span>';
                } else if (opType.includes('ماستر') || opType.includes('master')) {
                    opBadge = '<span class="badge bg-warning text-white">ماستركارد</span>';
                } else {
                    opBadge = `<span class="badge bg-secondary">${row.operation_type || '-'}</span>`;
                }

                // Date Formatting
                const date = new Date(row.reconciliation_date);
                const formattedDate = date.toLocaleDateString('en-GB');

                return `
                    <tr>
                        <td class="text-white text-center">${index + 1}</td>
                        <td class="text-center fw-bold">${formattedDate}</td>
                        <td class="text-center">${opBadge}</td>
                        <td class="text-center text-info fw-bold">
                            <div>${row.atm_name || '-'}</div>
                            ${(row.location || row.account_number) ? `<div class="text-secondary small fw-normal">${row.location || row.account_number}</div>` : ''}
                        </td>
                        <td class="text-center text-white">${row.bank_name || '-'}</td>
                        <td class="font-monospace text-success fw-bold text-ltr text-center fs-6">
                            ${formatCurrency(row.amount)} <small class="text-muted">SAR</small>
                        </td>
                        <td class="text-center text-white">${row.cashier_name || '-'}</td>
                        <td class="text-center font-monospace">
                            <span class="badge bg-secondary">#${row.reconciliation_number || row.reconciliation_id}</span>
                        </td>
                    </tr>
                `;
            }).join('');

            // 2. Render Mobile Cards
            if (cardsContainer) {
                cardsContainer.innerHTML = data.map(row => {
                    // Determine Icon and Color based on Operation type
                    let iconClass = 'fas fa-credit-card';
                    let colorClass = 'text-secondary';
                    let borderClass = 'border-secondary';
                    let glowColor = 'rgba(255,255,255,0.1)'; // Default glow



                    const opType = (row.operation_type || '').toLowerCase();
                    if (opType.includes('مدى') || opType.includes('mada')) {
                        colorClass = 'text-info';
                        borderClass = 'border-info';
                        glowColor = '#0dcaf0'; // Cyan
                    } else if (opType.includes('فيزا') || opType.includes('visa')) {
                        iconClass = 'fab fa-cc-visa';
                        colorClass = 'text-primary';
                        borderClass = 'border-primary';
                        glowColor = '#6366f1'; // Indigo
                    } else if (opType.includes('ماستر') || opType.includes('master')) {
                        iconClass = 'fab fa-cc-mastercard';
                        colorClass = 'text-warning';
                        borderClass = 'border-warning';
                        glowColor = '#f59e0b'; // Amber
                    }

                    const date = new Date(row.reconciliation_date);
                    const formattedDate = date.toLocaleDateString('en-GB');

                    return `
                    <div class="card glass-card mb-3 border border-secondary border-opacity-25 shadow-lg overflow-hidden position-relative" 
                         style="--card-glow: ${glowColor};">
                        <!-- Decoration Line -->
                        <div class="position-absolute top-0 end-0 bottom-0 ${borderClass.replace('border-', 'bg-')}" style="width: 4px;"></div>
                        
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h5 class="fw-bold text-white mb-1">
                                        <i class="${iconClass} ${colorClass} me-2"></i> ${row.atm_name || 'جهاز صراف'}
                                    </h5>
                                    <div class="text-white-50 small font-monospace mb-1">
                                        <i class="far fa-calendar-alt me-1"></i> ${formattedDate}
                                    </div>
                                    ${(row.location || row.account_number) ? `
                                    <div class="text-secondary small">
                                        ${row.location || row.account_number}
                                    </div>
                                    ` : ''}
                                </div>
                                <span class="badge bg-dark border ${borderClass} text-light font-monospace">#${row.reconciliation_number || row.reconciliation_id}</span>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center bg-dark bg-opacity-25 rounded-3 p-2 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-user-circle text-secondary me-2"></i>
                                    <span class="text-white small">${row.cashier_name || 'غير معروف'}</span>
                                </div>
                                <span class="badge ${borderClass.replace('border-', 'bg-')} text-dark fw-bold">${row.operation_type}</span>
                            </div>

                            <hr class="border-secondary opacity-25 my-2">
                            
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span class="text-secondary small">قيمة العملية</span>
                                <span class="fs-3 fw-bold text-success font-monospace dir-ltr">
                                    ${formatCurrency(row.amount)} <small class="fs-6 text-white-50">SAR</small>
                                </span>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
            }
        }

        function calculateAtmStats(data) {
            const count = data.length;
            const totalAmount = data.reduce((sum, r) => sum + Number(r.amount || 0), 0);
            const avgAmount = count > 0 ? totalAmount / count : 0;
            const maxAmount = count > 0 ? Math.max(...data.map(r => Number(r.amount || 0))) : 0;

            document.getElementById('statsAtmOps').textContent = formatNum(count);
            document.getElementById('statsAtmTotal').textContent = formatCurrency(totalAmount);
            document.getElementById('statsAtmAvg').textContent = formatCurrency(avgAmount);
            document.getElementById('statsAtmMax').textContent = formatCurrency(maxAmount);
        }

        function formatCurrency(val) {
            return Number(val || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatNum(val) {
            // Compact format for cards (e.g. 1.2k) if needed, currently full number
            return Number(val || 0).toLocaleString('en-US', { maximumFractionDigits: 0 });
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }
    </script>
</body>

</html>